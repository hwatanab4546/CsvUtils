
# CsvUtils

CSVファイルの読み書きが必要になることがたまにあるのですが、その都度下記を考慮するのが面倒なので、自分用の簡易なライブラリを用意しておくことにしました。

* 単純にカンマ(`,`)で区切って連結すればいいわけではない
* カンマを区切り文字として単純に`string.Split()`で処理すればいいというものでもない
* かといって有名どころをNuGetで取り込むにしても、そもそもCSVという形式の仕様自体が曖昧なので、微妙な仕様がライブラリごとに異なっている可能性があったり、オプションを調べるのも面倒くさい

## `string? Join(IEnumerable<string> columns)`

引数で与えられたコレクションに含まれる文字列をカンマ(`,`)を区切り文字として連結します。

* 引数が`null`の場合は`ArgumentNullException`例外が発生します
* 空コレクションが与えられた場合は`null`を返します
* 下記のいずれかの文字を含むフィールドはダブルクォート(`"`)で囲みます
  * カンマ(`,`)
  * ダブルクォート(`"`)。
  * 改行コード(CR、LF、またはCRLF)
* ダブルクォートで囲まれるフィールドに含まれていたダブルクォートは、ダブルクォートでエスケープされます
  * 例えばダブルクォート1文字のフィールド(`"`)は、ダブルクォートで囲まれると同時にダブルクォートでエスケープされるため、処理後のフィールドはダブルクォート4文字となります(`""""`)

## `IEnumerable<string> Split(string str)`

指定された文字列をカンマ(`,`)を区切り文字として分割します。

* 引数が`null`の場合は空コレクションを返します
* 先頭がダブルクォート(`"`)で始まるフィールドは、先頭のダブルクォートおよびそれに対応する(通常はフィールド末尾の)ダブルクォートを削除します
  * ダブルクォートで囲まれた範囲内に連続した2つのダブルクォートがある場合は、(ダブルクォートでエスケープされたダブルクォートとみなして)1つのダブルクォートに置換します
  * ダブルクォートで囲まれた範囲内にあるカンマは通常文字として扱います(つまり、区切り文字とはみなしません)
  * ダブルクォートで囲まれた範囲内にある改行コード(CR、LF、またはCRLF)は通常文字(列)として扱います
* 先頭がダブルクォートで始まっていないフィールドの途中にダブルクォートが存在する場合は、そのダブルクォートを通常文字として扱います(つまり、フィールドを囲むダブルクォートとはみなしません)
* ダブルクォートで囲まれていない部分に改行コードが含まれていた場合は`ArgumentException`例外が発生します

## `IEnumerable<string> Split(TextReader tr)`

`TextReader`から文字列を読込み、最初の改行コード(ダブルクォートで囲まれた範囲に含まれる改行コードは除く)までの範囲をカンマ(`,`)を区切り文字として分割します

* 先頭がダブルクォート(`"`)で始まるフィールドは、先頭のダブルクォートおよびそれに対応する(通常はフィールド末尾の)ダブルクォートを削除します
  * ダブルクォートで囲まれた範囲内に連続した2つのダブルクォートがある場合は、(ダブルクォートでエスケープされたダブルクォートとみなして)1つのダブルクォートに置換します
  * ダブルクォートで囲まれた範囲内にあるカンマは通常文字として扱います(つまり、区切り文字とはみなしません)
  * ダブルクォートで囲まれた範囲内にある改行コード(CR、LF、またはCRLF)は通常文字(列)として扱います
* 先頭がダブルクォートで始まっていないフィールドの途中にダブルクォートが存在する場合は、そのダブルクォートを通常文字として扱います(つまり、フィールドを囲むダブルクォートとはみなしません)
